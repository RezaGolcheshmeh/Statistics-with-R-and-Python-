# chapter2: Measures of variability

**Variability is most commonly measured with the following descriptive statistics:**

-   Range: the difference between the highest and lowest values.

-   Interquartile range: the range of the middle half of a distribution.

-   Standard deviation: average distance from the mean.

-   Variance: average of squared distances from the mean.

## Range in R

To calculate the range, simply subtract the largest data value from the smallest value.

```{r}
x <- c(12, 15, 18, 25, 30, 35)

range_value <- max(x) - min(x)
range_value
```

**Using range() function**

```{r}
x <- c(12, 15, 18, 25, 30, 35)
range(x)
```

**Using range() function with `NA`**

```{r}
x <- c(10, 15, NA, 25, 30, NA, 40)

range(x, na.rm = TRUE)
```

**Range in DataFrame**

```{r}
df <- data.frame(
  A = c(10, 15, 20, 25, 30),
  B = c(5, 7, 9, 12, 15),
  C = c(100, 120, 110, 130, 125),
  Gender = c("m", "f", "f", "m", "f")
)

df
```

**Using: `sapply` Numeric column**

```{r}
range_df <- sapply(df[, sapply(df, is.numeric)], function(x) max(x) - min(x))
range_df
```

**`aggregate()`** Categorical variables

```{r}
aggregate(cbind(A, B, C) ~ Gender, data = df,
          FUN = function(x) max(x) - min(x))
```

**Range in DataFrame with `NA`**

```{r}
df <- data.frame(
  A = c(10, 15, 20, 25, 30),
  B = c(5, NA, 9, 12, 15),
  C = c(100, 120, 110, 130, NA),
  Gender = c("m", "f", "f", "m", "f")
)

df
```

In R, to handle missing data we need to put `na.rm = TRUE` inside the function:

```{r}
aggregate(cbind(A, B, C) ~ Gender, data = df,
          FUN = function(x) max(x, na.rm = TRUE) - min(x, na.rm = TRUE))
```

## Range in Python

```{python}
data = [12, 15, 18, 25, 30, 35]

range_value = max(data) - min(data)
print(range_value)
```

**Range with missing data (`NA`) in Python**

```{python}
import pandas as pd

data = [10, 15, None, 25, 30, None, 40]
s = pd.Series(data)

range_value = s.max() - s.min()

print(range_value)
```

**Range with DataFrame (**Numeric columns**)**

```{python}
import pandas as pd

data = {
    "A": [10, 15, 20, 25, 30],
    "B": [5, 7, 9, 12, 15],
    "C": [100, 120, 110, 130, 140]
}
df = pd.DataFrame(data)

range_values = df.max() - df.min()
print(range_values)
```

Only for one column

```{python}
range_A = df["A"].max() - df["A"].min()
print(range_A)
```

**Range with DataFrame (**Numeric + Categorical**)**

```{python}
import pandas as pd

data = {
    "A": [10, 15, 20, 25, 30],
    "B": [5, 7, 9, 12, 15],
    "C": [100, 120, 110, 130, 140],
    "Gender": ["Male", "Female", "Male", "Female", "Male"]
}
df = pd.DataFrame(data)

range_values = df.select_dtypes(include="number").max() - df.select_dtypes(include="number").min()

print(range_values)
```

## **Deciles, Percentiles, and Quartiles in R**

### **1.Deciles in R**

Deciles divide the data into 10 equal groups (each 10%).

```{r}
data <- c(12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50)
quantile(data, probs = seq(0, 1,by = 0.1))
```

### 2. **Percentiles in R**

To calculate any percentile, use the same function with a decimal value.

**For exampl**e, the 25th percentile and the 90th percentile:

```{r}
data <- c(12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50)
quantile(data, probs = c(0.25, 0.9))

```

Or all percentiles (as a complete vector):

```{r}
data <- c(12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50)
quantile(data, probs = seq(0, 1, 0.01))
```

### 3. **Quartiles in R**

You can use the `quantile()` function to compute quartiles.

```{r}
data <- c(12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50)
quantile(data)

quantile(data, probs = c(0.25, 0.5, 0.75))
```

**Quartiles with `NA`**

`na.rm = TRUE`

```{r}
data <- c(12, 5, 7, NA, 15, 18, 22, NA, 30, 35, 40, 50)
quantile(data, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
```

If you want, without removing `NA` but replacing it with the `mean`.

```{r}
data <- c(12, 5, 7, NA, 15, 18, 22, NA, 30, 35, 40, 50)
data_filled <- ifelse(is.na(data), mean(data, na.rm = TRUE), data)
quantile(data_filled)
```

**DataFrame with `NA`**

Calculating quartiles for each column

```{r}
df <- data.frame(
  height = c(160, 165, 170, NA, 180, 190, NA),
  weight = c(50, 55, NA, 70, 80, 90, 95),
  age    = c(20, 25, 30, 35, NA, 45, 50)
)

sapply(df, function(x) quantile(x, probs = c(0.25, 0.5, 0.75), na.rm = TRUE))
```

**for a column**

```{r}
quantile(df$weight, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
```

**DataFrame with Categorical variable**

```{r}
df <- data.frame(
  height = c(160, 165, 170, NA, 180, 190, NA),
  weight = c(50, 55, NA, 70, 80, 90, 95),
  age    = c(20, 25, 30, 35, NA, 45, 50),
  Gender = c('Male', 'Female', 'Male', 'Female', 'Male', 'Female', 'Male')
)

quantile(df$height, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
quantile(df$weight, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
quantile(df$age,    probs = c(0.25, 0.5, 0.75), na.rm = TRUE)

```

**with `dplyr`**

```{r}
library(dplyr)

df %>%
  group_by(Gender) %>%
  summarise(
    height_Q1 = quantile(height, 0.25, na.rm = TRUE),
    height_Median = quantile(height, 0.5, na.rm = TRUE),
    height_Q3 = quantile(height, 0.75, na.rm = TRUE),
    
    weight_Q1 = quantile(weight, 0.25, na.rm = TRUE),
    weight_Median = quantile(weight, 0.5, na.rm = TRUE),
    weight_Q3 = quantile(weight, 0.75, na.rm = TRUE),
    
    age_Q1 = quantile(age, 0.25, na.rm = TRUE),
    age_Median = quantile(age, 0.5, na.rm = TRUE),
    age_Q3 = quantile(age, 0.75, na.rm = TRUE)
  )

```

**with `tapply`**

**By Gender variable**

```{r}
df <- data.frame(
  height = c(160, 165, 170, NA, 180, 190, NA),
  weight = c(50, 55, NA, 70, 80, 90, 95),
  age    = c(20, 25, 30, 35, NA, 45, 50),
  Gender = c('Male', 'Female', 'Male', 'Female', 'Male', 'Female', 'Male')
)

tapply(df$height, df$Gender, function(x) quantile(x, probs = c(0.25,0.5,0.75), na.rm = TRUE))

```

## Interquartile Range in R - IQR

the interquartile range is the difference between the upper quartile and the lower quartile.

```         
IQR=Q3−Q1
```

**`IQR()`** **Function**

```{r}
data <- c(12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50)
IQR(data)
```

**Function `quantile()`**

```{r}
Q1 <- quantile(data, 0.25)
Q3 <- quantile(data, 0.75)
IQR <- Q3 - Q1
IQR
```

**DataFrame (Numeric)**

**`sapply`**

```{r}
df <- data.frame(
  height = c(160, 165, 170, 172, 180, 190),
  weight = c(50, 55, 60, 70, 80, 90)
)

sapply(df, IQR)
```

**DataFrame with `NA`**

```{r}
df <- data.frame(
  height = c(160, 165, 170, NA, 180, 190, NA),
  weight = c(50, 55, NA, 70, 80, 90, 95),
  age    = c(20, 25, 30, 35, NA, 45, 50)
)

sapply(df, IQR, na.rm = TRUE)
```

Just for weight

```{r}
IQR(df$weight, na.rm = TRUE)
```

**DataFrame (Numerical + Categorical) variable**

```{r}
df <- data.frame(
  gender = c("Male", "Female", "Male", "Female", "Male", "Female", "Male"),
  height = c(160, 165, 170, NA, 180, 190, NA),
  weight = c(50, 55, NA, 70, 80, 90, 95),
  age    = c(20, 25, 30, 35, NA, 45, 50)
)
df

by(df$weight, df$gender, function(x) quantile(x, probs = c(0.25, 0.5, 0.75), na.rm = TRUE))

```

```{r}
tapply(df$weight, df$gender, IQR, na.rm = TRUE)
```

If you want to calculate height, weight, and age all at once:

```{r}
library(dplyr)

df %>%
  group_by(gender) %>%
  summarise(
    IQR_height = IQR(height, na.rm = TRUE),
    IQR_weight = IQR(weight, na.rm = TRUE),
    IQR_age    = IQR(age, na.rm = TRUE)
  )
```

## Percentiles and **Quartiles in Python**

### Percentiles in Python

**Percentiles are a type of quantiles**, obtained by a subdivision into 100 groups.

**NumPy : `numpy.percentile()`**

```{python}
import numpy as np

data1 = [12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50]
percentiles = np.percentile(data1, [25, 50, 75])

print(percentiles)
```

Data with `Nan`(Missing Data)

```{python}
import numpy as np

data2 = [12, 5, 7, np.nan, 15, 18, 22, 25, 30, np.nan, 40, 50]
percentiles = np.nanpercentile(data2, [25, 50, 75])

print(percentiles)
```

**DataFrame (Numerical)**

```{python}
import pandas as pd

df = pd.DataFrame({
    'Height': [174, 180, 165, 190],
    'Weight': [80, 85, 70, 95]
})

print(df.quantile([0.25, 0.5, 0.75]))
```

**DataFrame (Categorical + Numerical)**

Calculate percentiles for all data.

```{python}
import pandas as pd

df = pd.DataFrame({
    'Height': [174, 180, 165, 190],
    'Weight': [80, 85, 70, 95],
    'Gender': ['Male', 'Male', 'Female', 'Male']
})

# Calculate percentiles for numeric columns
percentile_values = df[['Height', 'Weight']].quantile([0.1, 0.25, 0.5, 0.75, 0.9])

print(percentile_values)
```

Calculate percentiles grouped by Gender.

```{python}
import pandas as pd

# Create DataFrame
df = pd.DataFrame({
    'Height': [174, 180, 165, 190],
    'Weight': [80, 85, 70, 95],
    'Gender': ['Male', 'Male', 'Female', 'Male']
})

# Group by Gender and calculate percentiles
percentiles = df.groupby('Gender')[['Height', 'Weight']].quantile([0.25, 0.5, 0.75])

print(percentiles)
```

### **Quartiles in Python**

In statistics, quartiles are a type of quantiles which **divide the number of data points into four parts.**

**NumPy (`quantile`)**

```{python}
import numpy as np

data = [12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50]

median = np.quantile(data, 0.5)
print("Median:", median)
```

**Other Quartiles**

```{python}
data4 = [12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50]

quartiles = np.quantile(data4, [0.25, 0.5, 0.75])
print(quartiles)


q1 = np.quantile(data4, 0.25)
q2 = np.quantile(data4, 0.5)
q3 = np.quantile(data4, 0.75)
```

**NumPy (`percentile`)**

```{python}
import numpy as np
data2 = [12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50]

median2 = np.percentile(data2, 50)
print("Median2:", median2)
```

**Pandas**

```{python}
import pandas as pd
data3 = [12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50]
data_series = pd.Series(data3)
median3 = data_series.quantile(0.5)

print("Median3:", median3)
```

## **Interquartile range in Python - IQR**

**NumPY: `quantile`**

```{python}
import numpy as np

data = [12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50]

q1 = np.quantile(data, 0.25)
q3 = np.quantile(data, 0.75)  

iqr = q3 - q1
print("IQR:" , iqr)
```

**pandas**

```{python}
import pandas as pd
import numpy as np

data = [12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50]
df = pd.DataFrame({'values': data})

q1 = df['values'].quantile(0.25)
q3 = df['values'].quantile(0.75)

iqr = q3 - q1
print("IQR:" , iqr)
```

**`scipy.stats`**

```{python}
from scipy import stats

data = [12, 5, 7, 9, 15, 18, 22, 25, 30, 35, 40, 50]
iqr = stats.iqr(data)

print("IQR:" , iqr)
```

**DataFrame**

```{python}
import pandas as pd
from scipy.stats import iqr

df = pd.DataFrame({
    'Gender': ['Male', 'Female', 'Male', 'Female', 'Male'],
    'Score1': [85, 90, 78, 92, 88],
    'Score2': [80, 95, 70, 89, 85]
})

iqr_overall = df[['Score1','Score2']].agg(iqr)

print(iqr_overall)
```

## Mean absolute deviation in R

**What is Mean Absolute Deviation?**

It is the **average of the absolute differences** between each value and the **mean** of the data.

So the steps are:

1.  Compute the mean of the data.

2.  Subtract the mean from each value (deviation).

3.  Take the absolute value of each deviation.

4.  Take the mean of those absolute values.

5.  The `lsr` package does all of this for you with one simple function: **`aad()`**.

```{r}
install.packages("lsr")
library(lsr)

scores <- c(10, 12, 13, 15, 18)
aad(scores)
```

This will:

-   compute the mean of `scores`,

-   compute the absolute deviations from that mean,

-   return the **average** of those absolute deviations.

-   So `aad(scores)` is equivalent to:

```{r}
mean(abs(scores - mean(scores)))
```

**Comparing with the base R `mad()` function**

Be careful: base R already has a function named `mad()`:

But:

-   `mad()` = **Median Absolute Deviation** (based on the **median** and usually scaled)

-   `aad()` (from `lsr`) = **Average Absolute Deviation** (typically from the **mean**, unless you specify a different center).

**Working with data with missing values:**

```{r}
library(lsr)

data <- c(12, 15, NA, 22, 25, 28, NA, 35, 40, 45)
aad(data, na.rm = TRUE)
```

**DataFrame**

```{r}
df <- data.frame(
  age = c(25, 30, 35, 40, 45, 28, 32, 38, 42, 50,
          22, 27, 33, 36, 44, 29, 31, 39, 41, 47),
  salary = c(30000, 35000, 42000, 50000, 58000, 
             32000, 38000, 45000, 52000, 60000,
             28000, 33000, 40000, 47000, 55000,
             31000, 37000, 44000, 51000, 59000),
  Gender = c("Male", "Female", "Male", "Female", "Male",
             "Female", "Male", "Female", "Male", "Female",
             "Male", "Female", "Male", "Female", "Male",
             "Female", "Male", "Female", "Male", "Female")
)
```

**Numerical column**

```{r}
aad(df$age)

aad(df$salary)
```

**MAD by Gender**

```{r}
tapply(df$age, df$Gender, aad)
tapply(df$salary, df$Gender, aad)
```

## **Mean Absolute Deviation (MAD) in Python**

**Calculating MAD with pandas Series**

```{python}
import pandas as pd

data = pd.Series([56, 31, 56, 8, 32])
mad = (data - data.mean()).abs().mean()
print(mad)
```

**MAD with `statsmodels`**

```{python}
from statsmodels import robust

data = [56, 31, 56, 8, 32]
mad = robust.meanabs(data)
print(mad)
```
